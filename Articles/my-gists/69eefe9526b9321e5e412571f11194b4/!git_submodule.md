# Git submoduleに関する知識

Git submodule（サブモジュール）は、Gitリポジトリ内に別のGitリポジトリをサブリポジトリとして組み込む仕組みです。これにより、プロジェクト内で外部ライブラリやコンポーネントを簡単に管理できるようになります。サブモジュールは、特定のコミットを指すGitリポジトリのクローンであり、親リポジトリとサブモジュールリポジトリは独立して管理されます。

以下は、Git submoduleに関する基本的な情報と操作についての説明です。

1. サブモジュールの追加

    サブモジュールを親リポジトリに追加するには、次のコマンドを使用します：

    ```
    git submodule add <サブモジュールのリポジトリURL> <サブモジュールのディレクトリ>
    ```

1. サブモジュールの初期化

    ```
    git submodule init
    ```

1. サブモジュールの更新

    サブモジュールのコミットが更新された場合、親リポジトリ内でサブモジュールを最新のコミットに更新する必要があります。以下のコマンドを使用して、サブモジュールを最新の状態に更新します：

    ```
    git submodule update --remote
    ```

1. サブモジュールのクローン

    サブモジュール内のコードを取得するには次のコマンドを使用します

    ```
    git submodule update --init --recursive
    ```

1. サブモジュール内の各サブモジュールに対して, 指定されたコマンドを実行

      ```
      git submodule foreach git pull origin main
      ```

このコマンドを使用することで、親リポジトリ内のすべてのサブモジュールを最新の状態に保つことができます。これは、サブモジュールの変更がある場合や、複数のサブモジュールを持つプロジェクトで特に便利です。

注意事項として、サブモジュールは親リポジトリのコミットにバインドされており、各サブモジュールは特定のコミットを指しています。したがって、このコマンドは各サブモジュールが指定したブランチ（この場合はmaster）の最新のコミットを取得します。サブモジュールが異なるブランチやコミットを使用している場合、それを考慮する必要があります。


サブモジュールを追加した後、変更をコミットに含めるために以下のコマンドを実行します。

  ```bash
  git add .gitmodules <path>
  git commit -m "Added <repository> as submodule"
  ```

ここで、`<path>`はサブモジュールを配置したいディレクトリのパス、`<repository>`はサブモジュールとして追加したいリポジトリのURLです。

***

git submodule initコマンドは、サブモジュールの初期化を行うもので、主に.gitmodulesファイルの内容をローカルのGit設定に登録します。このコマンドは、サブモジュールを追加した後に、そのリポジトリをクローンした他の開発者が実行することが一般的です。

サブモジュールを追加した際に自分がgit submodule initを実行しないと、以下のようなことが起こります。

ローカルの設定への影響: git submodule initは主にローカルの設定に影響を与えるため、このコマンドを実行しなくても、サブモジュールの追加自体には影響しません。サブモジュールの追加は、.gitmodulesファイルとサブモジュールのパスをステージングしてコミットすることで完了します。

他の開発者への影響: 他の開発者がリポジトリをクローンした後、サブモジュールを初期化して更新するためにgit submodule initとgit submodule updateを実行する必要があります。これらのコマンドを実行しないと、サブモジュールのディレクトリは空のままになります。

自分自身への影響: サブモジュールを追加した後にgit submodule initを実行しないと、ローカルの設定にサブモジュールの情報が登録されません。しかし、サブモジュールを追加する際にはこのコマンドの実行は通常必要ありません。

要するに、git submodule initはサブモジュールを追加する際に自分が実行する必要はなく、主に他の開発者がリポジトリをクローンした後にサブモジュールを初期化するために使用されます。自分がgit submodule addを実行した際には、.gitmodulesファイルとサブモジュールのパスをステージングしてコミットするだけで問題ありません。

git submodule addコマンドを実行すると、サブモジュールの情報が2つの場所に保存されます。

.gitmodulesファイル: このファイルには、サブモジュールのURLとローカルでのパスが記録されます。この情報はリポジトリに共有されるため、他の人も同じサブモジュール情報を持つことができます。

.git/configファイル: このファイルにもサブモジュールの情報が保存されますが、この情報はローカルのみで共有されません。

git submodule initコマンドは、サブモジュールの初期化を行うもので、主に.gitmodulesファイルの内容をローカルのGit設定に登録します。このコマンドは、サブモジュールを追加した後に、そのリポジトリをクローンした他の開発者が実行することが一般的です。

サブモジュールを追加した際に自分がgit submodule initを実行しないと、以下のようなことが起こります。

ローカルの設定への影響: git submodule initは主にローカルの設定に影響を与えるため、このコマンドを実行しなくても、サブモジュールの追加自体には影響しません。サブモジュールの追加は、.gitmodulesファイルとサブモジュールのパスをステージングしてコミットすることで完了します。

他の開発者への影響: 他の開発者がリポジトリをクローンした後、サブモジュールを初期化して更新するためにgit submodule initとgit submodule updateを実行する必要があります。これらのコマンドを実行しないと、サブモジュールのディレクトリは空のままになります。

自分自身への影響: サブモジュールを追加した後にgit submodule initを実行しないと、ローカルの設定にサブモジュールの情報が登録されません。しかし、サブモジュールを追加する際にはこのコマンドの実行は通常必要ありません。

要するに、git submodule initはサブモジュールを追加する際に自分が実行する必要はなく、主に他の開発者がリポジトリをクローンした後にサブモジュールを初期化するために使用されます。自分がgit submodule addを実行した際には、.gitmodulesファイルとサブモジュールのパスをステージングしてコミットするだけで問題ありません。


## Clone との違い
  
サブモジュールと通常のクローンとを比較した場合の主な利点は次の通りです：

部分的なコードの取得: クローンではリポジトリ全体を取得しますが、サブモジュールを使用すると特定のディレクトリやコンポーネントのみを取得できます。プロジェクトに必要な部分だけを取得できるため、冗長なデータのダウンロードを減らすことができます。

外部依存関係の管理: サブモジュールを使用すると、プロジェクトが外部の依存関係（他のリポジトリやライブラリ）を簡単に管理できます。特定のバージョンの外部コンポーネントを取得し、プロジェクトに統合することができます。

独立したバージョン管理: サブモジュール内のコードは独立してバージョン管理されます。このため、サブモジュールごとに異なるバージョンやコミットを使用でき、プロジェクト内のバージョンの衝突を回避できます。

コードの再利用: サブモジュールを使用することで、コードやリソースを他のプロジェクトでも再利用できます。これにより、共通のコードを複数のプロジェクトで共有できます。

プロジェクトのモジュラリティ: サブモジュールを使用すると、プロジェクトをモジュール化できます。大規模なプロジェクトを小さな独立モジュールに分割し、それぞれを独立して開発・テストできます。

外部リポジトリへの貢献: サブモジュールを使用するプロジェクトは、外部リポジトリへの貢献を行いやすくなります。サブモジュール内での変更を元のリポジトリにプッシュすることができます。

プロジェクトの更新と保守: サブモジュールは独立してメンテナンスできます。外部リポジトリが更新された場合、それをプロジェクトに統合することが容易です。

ただし、サブモジュールの管理には追加の手間と学習コストがかかります。正しいバージョンのサブモジュールを選択し、変更をプロジェクトに統合する方法を理解する必要があります。また、プロジェクト内で複数のサブモジュールを使用する場合、それらのサブモジュールの依存関係を適切に管理することも重要です。


