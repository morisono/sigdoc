![Altimeter](https://user-images.githubusercontent.com/111455900/271257284-d6405ce7-4657-40cb-905e-a05fb74d4468.png)

# Analog Gauge Reader 

Analog Gauge Readerは、アナログ計器（ゲージ）から情報を読み取るためのソフトウェアまたはデバイスです。これは、機械的なゲージや計器を使用してデータを可視化するためのツールやアプリケーションを含みます。アナログ計器は針や目盛りを使用してデータを示すため、その読み取りには光学的なセンシングや画像処理技術が利用されることが一般的です。

Analog Gauge Readerは、産業用途、自動車、航空、エネルギー管理、環境モニタリングなど、さまざまな分野で使用されます。これにより、人間の介入なしに計器からデータを収集し、デジタルフォーマットに変換できるため、データの収集と分析が自動化され、効率が向上します。

この技術は、リアルタイムモニタリング、データ記録、トラブルシューティング、予測保守などのアプリケーションで重要な役割を果たしており、産業プロセスの効率向上や品質管理に貢献しています。さらに、Analog Gauge Readerは、IoT（モノのインターネット）デバイスと統合され、クラウドベースのシステムにデータを送信することができるため、データの可視性と遠隔監視が向上します。


## 技術的仕様

以下のような処理が実行されます。

1. **必要なライブラリのインポート**
    1. **OpenCVとNumPyのインポート**: OpenCVとNumPyをインポートしています。
1. **具体的な処理手順**
    1. **画像の読み込み**: ゲージの画像を読み込みます。read_image関数では、アナログ計器のイメージファイルを読み取り、各フレームでの針の角度を測定します。
    1. **ビデオファイルの読み取り**: アナログ計器のビデオファイルを読み取り、各フレームでの針の角度を測定します。read_video関数では、アナログ計器のビデオファイルを読み取り、各フレームでの針の角度を測定します。
        1. 計器の部分をクロップします。
        1. HSV色空間に変換し、特定の色域をマスクします。またはRGBに変換し、JPEGバッファに変換します。
        1. オープニング、クロージング、ダイレーションなどの形態学的操作を適用します。
        1. ガウシアンブラーを使用して画像をぼかします。
        1. プロバビリスティック・ハフ変換を使用して画像内の直線を見つけます。
1. **制約条件の入力**: ゲージの最小角度、最大角度、最小値、最大値、単位をユーザーから取得します。
    1. **クロップのサイズ、彩度の閾値、ハフ変換のパラメータ**
    1. **グレースケール変換**: 画像をグレースケールに変換します。
1. **ストップウォッチ/アラート設定**: アラーム用の周波数と持続時間を設定します。
    1. **時間変換関数**: 秒を時間、分、秒に変換する関数を定義します。
    1. **メール情報の設定**: カメラIP情報、送信者と受信者のメールアドレス、パスワードなどの設定を行います。
1. **円の処理**
    1. **円の検出**: ゲージの円を検出します。
    1. **円の平均計算**: 検出された円の平均値を計算します。avg_circles関数は、検出された複数の円の中心と半径の平均値を計算します。
1. **ゲージのキャリブレーション**
    1. **2点間の距離計算**: dist_2_pts関数は、2点間のユークリッド距離を計算します。
    1. **キャリブレーションラインの描画**: ゲージのキャリブレーションのために、中心から外向きに等間隔のラインを描画します。calibrate_gauge関数は、ゲージの画像からゲージの中心と半径を検出し、ゲージの最小値と最大値をユーザーから取得します。この関数は、ゲージの最小角度、最大角度、最小値、最大値、単位、中心の座標、半径を返します。
    1. **ユーザー入力の取得**: ゲージの最小角度、最大角度、最小値、最大値、単位をユーザーから取得します。
1. **ゲージの針の処理**
    1. **閾値処理**: ゲージの針を検出するために、閾値処理を適用します。
    1. **ラインの検出**: ゲージの針を表すラインを検出します。
    1. **ラインのフィルタリング**: ゲージの中心から適切な距離にあるラインのみを選択します。
    1. **値の計算**: ゲージの針の角度から現在の値を計算します。get_current_value関数は、ゲージの画像から現在の値を読み取ります。この関数は、ゲージの針の角度を計算し、キャリブレーションデータを使用して現在の値を計算します。
    3. **角度の計算**: ゲージの針の角度を計算します。ビデオで観測された最大および最小の角度を使用して、角度を計器の単位にマッピングします。
1. **結果の表示**: ゲージの現在の読み取り値を表示します。
    1. **処理中のフレーム**:処理中のフレームを表示します。
    2. **サークルの描画**: サークルの中心と円を描画します。
    3. **ゲージの目盛りの描画**: ゲージの目盛りとラベルを描画します。
    4. **角度から値へのマッピング**: ビデオで観測された最大および最小の角度を使用して、角度を計器の単位にマッピングします。
    5. **データのプロット**: matplotlibを使用して、時間と値のプロットを作成します。
    6. **加熱・冷却曲線のフィッティング**: データに対して加熱と冷却の曲線をフィットさせ、そのパラメータを表示します。対数関数を使用してフィッティングを行います。
    7. **アノテーションビデオの保存**: オプションでアノテーション付きのビデオを保存します。
    8. **ストップウォッチの停止**: 処理にかかった時間を表示します。
  
## 単位計算について
PSIの計算: 角度からPSIを計算し、閾値を超えた場合にアラームを鳴らします。

1. **ゲージの精度に基づく圧力測定の解釈**
    1. **精度±1%の場合**: 圧力は3750 PSI±60 PSIで、実際の圧力は3690 PSIから3810 PSIの範囲になります。
    2. **精度±2%の場合**: 圧力は7800 PSI±400 PSIで、実際の圧力は7400 PSIから8200 PSIの範囲になります。
    3. **精度±0.5%の場合**: 圧力は560 PSI±5 PSIで、実際の圧力は555 PSIから565 PSIの範囲になります。
    4. **精度±2%の場合**: 圧力は2.5 ”H2O±0.6 ”H2Oで、実際の圧力は1.9 ”H2Oから3.1 ”H2Oの範囲になります。
2. **温度測定の解釈と他のポインターの意味**
    - 現在の温度は40度Cで、もう一つのポインターは低温キャプチャを示しています。
3. **レベルインジケータの測定の解釈**
    - 赤いポインターは61%のプロセスレベルを示しています。
4. **ロタメーターによる空気流量測定の解釈**
    - ボールの中心が“1”マークの最も近い半分の部分にあることがわかります。
5. **Uチューブマノメーターによる圧力測定の解釈**
    - 圧力差は液体柱の約22インチです。


## Issue

1. ノイズ
1. スケールの印刷のずれ
    1. オブジェクトの影 (背景にマークできる) を使用して、ゲージに対するカメラの角度と位置を調整できます。
1. ユースケースの考察: この技術は、特に遠隔地にあるゲージを監視する必要がある産業にどのように利用できるか？
1. ディープラーニングの利用: OpenCVなどの従来の画像解析技術と比較して、DeepLearningが提供する主な利点は何か？
1. クラウドプラットフォームの役割: GCPなどを活用してクラウド上にデータをプールすることは可能か？


[^1]: [List](https://github.com/jacobcantwell/read-analogue-gauges-with-machine-learning-on-aws/blob/main/content//notes.md)[^1]
[^2]: [DeepDetector NTT](https://www.nttcom.co.jp/english/news/en22102501.html)[^2]
[^3]: [Deep Gaugeプロジェクト](https://objectcomputing.com/resources/publications/sett/june-2019-using-machine-learning-to-read-analog-gauges)[^3]
[^4]: [Ai-on-the-Edge](https://github.com/sipeed/MaixPy)[^4]
[^5]: [Analog Read Serial](https://docs.arduino.cc/built-in-examples/basics/AnalogReadSerial)[^5]
[^6]: [Reading analog gauges with the Nicla Vision](https://blog.arduino.cc/2022/08/13/reading-analog-gauges-with-the-nicla-vision/)[^6]
[^7]:  https://www.mdpi.com/2673-4001/3/4/32 [^7]
